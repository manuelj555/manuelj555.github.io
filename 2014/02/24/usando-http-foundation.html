<!DOCTYPE html>
<html>
<head>   
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>PHP + Symfony Tips - Usando el componente HttpFoundation</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

</head>
<body class="home-template">

    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="http://manuelj555.github.io/">
                
                <span class="blog-title">PHP + Symfony Tips</span>
                 
            </a>
        </header>

        <span class="post-meta">
            <time datetime="2014-02-24">24 Feb 2014</time>
            
            on
            
            
       	</span>

        <h1 class="post-title">Usando el componente HttpFoundation</h1>

        <section class="post-content">
            <p>El componente HttpFoundation de Symfony permite encapsular y manejar la información de una petición de manera orientada a objetos, y ofrece una capa robusta que nos abstrae de tareas que pueden resultar tediosas de hacer a mano.</p>

<p>Basicamente el componente ofrece una serie de clases que permiten acceder a la información de la petición (Request) y clases que facilitan la creación de respuestas http a devolver (Response).</p>

<h2>¿Porque usar este componente?</h2>

<p>En mi opinión este componente facilita la realización de tareas que de otra forma llegan a ser engorrosas y tediosas, ejemplo de ellos son:</p>

<ul>
<li>  Subida de archivos al servidor.</li>
<li>  Manejo de cookies.</li>
<li>  Gestión de Sessión (Sesión por defecto, en Base de datos, en archivos, etc...).</li>
<li>  Saber si una petición es asincrona.</li>
<li>  Verificar que un parametro venga o exista en alguna de las variables super globales.</li>
<li>  Obtener información de la url, como el puerto, el queryString, pathinfo, host, etc...</li>
<li>  Seteo de los headers para la respuesta (algo que muchas veces no hacemos).</li>
<li>  Manejo de Códigos de estado para la respuesta.</li>
<li>  Creación de headers para descarga de archivos.</li>
<li>  Entre otras cosas que aun no he usado...</li>
</ul>

<p>Y lo más importante, si ya existe algo que nos ofrece todo esto y lo hace bien, ¿porque vamos a estar reinventando la rueda haciendo las cosas de cero?.</p>

<h2>Instalando el componente</h2>

<p>Para descargar el componente lo recomendable es hacerlo mediante composer, archivo composer.json:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="lineno">1</span> <span class="p">{</span>
<span class="lineno">2</span>     <span class="nt">&quot;require&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="lineno">3</span>         <span class="nt">&quot;symfony/http-foundation&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
<span class="lineno">4</span>     <span class="p">}</span>
<span class="lineno">5</span> <span class="p">}</span></code></pre></figure>

<p>Ahora solo hace falta ejecutar el comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">php composer install
</code></pre></div>
<h2>Creando el objeto Request</h2>

<p>Crear la instancia del Request es tan sencillo como ejecutar el siguiente código:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span> <span class="c1">//proyecto/index.php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/vendor/autoload.php&#39;</span><span class="p">;</span>
<span class="lineno">4</span> 
<span class="lineno">5</span> <span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="lineno">6</span> 
<span class="lineno">7</span> <span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span> <span class="c1">//acá creamos el objeto request</span></code></pre></figure>

<p>El método <strong>createFromGlobals()</strong> crea una instancia con la información de la petición a partir de las variables globales de php $<em>GET, $</em>POST, $<em>REQUEST, $</em>SERVER, $<em>FILES y $</em>COOKIE.</p>

<p>Ahora podemos obtener la info del request desde los atributos del objeto:</p>

<h5>El atributo query:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\ParameterBag)</strong> y contiene la información contenida en la variable global $_GET, para usarlo desde el objeto request lo hacemos de la siguiente manera:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">);</span> 
<span class="lineno"> 4</span> <span class="c1">//devuelve el valor contenido en $_GET[&#39;nombre&#39;] si existe, si no devuelve null</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;Manuel&#39;</span><span class="p">);</span> 
<span class="lineno"> 7</span> <span class="c1">//si no se encuentra el indice nombre en $_GET el método devuelve &#39;Manuel&#39; por defecto.</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;usuario[nombre]&#39;</span><span class="p">,</span> <span class="s1">&#39;Manuel&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> 
<span class="lineno">10</span> <span class="c1">//acá hay algo interesante, si el indice usuario contiene un array, el componente</span>
<span class="lineno">11</span> <span class="c1">//intentará devolver el valor de la siguiente manera: $_GET[&#39;usuario&#39;][&#39;nombre&#39;]</span>
<span class="lineno">12</span> <span class="c1">//recordar que para que funcione, se debe pasar true en el tercer argumento.</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<h5>El atributo request:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\ParameterBag)</strong> y contiene la información contenida en la variable global $_POST, para usarlo desde el objeto request lo hacemos de la siguiente manera:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">);</span> 
<span class="lineno"> 4</span> <span class="c1">//devuelve el valor contenido en $_POST[&#39;nombre&#39;] si existe, si no devuelve null</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;Manuel&#39;</span><span class="p">);</span> 
<span class="lineno"> 7</span> <span class="c1">//si no se encuentra el indice nombre en $_POST el método devuelve &#39;Manuel&#39; por defecto.</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;usuario[nombre]&#39;</span><span class="p">,</span> <span class="s1">&#39;Manuel&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> 
<span class="lineno">10</span> <span class="c1">//acá hay algo interesante, si el indice usuario contiene un array, el componente</span>
<span class="lineno">11</span> <span class="c1">//intentará devolver el valor de la siguiente manera: $_POST[&#39;usuario&#39;][&#39;nombre&#39;]</span>
<span class="lineno">12</span> <span class="c1">//recordar que para que funcione, se debe pasar true en el tercer argumento.</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<h5>El atributo server:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\ServerBag)</strong> y contiene la información contenida en la variable global $_SERVER, para usarlo desde el objeto request lo hacemos de la siguiente manera:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">);</span> 
<span class="lineno">4</span> <span class="c1">//devuelve el valor contenido en $_SERVER[&#39;QUERY_STRING&#39;] si existe, si no devuelve null</span>
<span class="lineno">5</span> 
<span class="lineno">6</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_FILENAME&#39;</span><span class="p">);</span> 
<span class="lineno">7</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">);</span> 
<span class="lineno">8</span> 
<span class="lineno">9</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<p>Igualmente se pueden establecer valores por defecto para cuando el indice no exista.</p>

<h5>La propiedad attributes:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\ParameterBag)</strong>, y se utiliza para establecer información referente a la petición en las aplicaciones, por ejemeplo, el framework symfony almacena allí la info concerniente a la ruta que se está ejecutando (el controlador y la acción a llamar, los parametros enviados en la ruta, etc).</p>

<p>Este objeto es muy util para almacenar información dependiendo de los requerimientos de la app.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> 
<span class="lineno">4</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> 
<span class="lineno">5</span> 
<span class="lineno">6</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> 
<span class="lineno">7</span> 
<span class="lineno">8</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<h5>El atributo files:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\FileBag)</strong>, y contiene un arreglo de objetos de tipo <strong>(\Symfony\Component\HttpFoundation\File\UploadedFile)</strong>. listos para ser usados.</p>

<p>Este contenedor es muy util a la hora de leer archivos subidos al servidor, porque los objetos que contiene ofrecen una serie de métodos que nos permitirán manejar los archivos facilmente.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">files</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foto&#39;</span><span class="p">);</span> 
<span class="lineno"> 4</span> <span class="nv">$movedFile</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="s1">&#39;diretorio&#39;</span><span class="cm">/*, &#39;nombre.jpg&#39; */</span><span class="p">);</span> 
<span class="lineno"> 5</span> <span class="c1">//guardar el archivo es tan sencillo como llamar al metodo move()</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
<span class="lineno"> 8</span>     <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getExtension</span><span class="p">();</span>
<span class="lineno"> 9</span>     <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getMimeType</span><span class="p">();</span>
<span class="lineno">10</span>     <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getFilename</span><span class="p">();</span>
<span class="lineno">11</span>     <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getSize</span><span class="p">();</span>
<span class="lineno">12</span>     <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getBasename</span><span class="p">();</span>
<span class="lineno">13</span>     
<span class="lineno">14</span>     <span class="nv">$movedFile</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="s1">&#39;diretorio&#39;</span><span class="cm">/*, &#39;nombre.jpg&#39; */</span><span class="p">);</span> 
<span class="lineno">15</span> 
<span class="lineno">16</span> <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="lineno">17</span>     <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">();</span> <span class="c1">//devuelve el número del error</span>
<span class="lineno">18</span> <span class="p">}</span>
<span class="lineno">19</span> 
<span class="lineno">20</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">files</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<h5>El atributo cookies:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\ParameterBag)</strong>, y contiene la información contenida en la variable global $_COOKIE, para usarlo desde el objeto request lo hacemos de la siguiente manera:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">cookie</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;parametro&#39;</span><span class="p">);</span>
<span class="lineno">4</span> 
<span class="lineno">5</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">cookie</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<h5>El atributo headers:</h5>

<p>Este atributo es una instancia de <strong>(\Symfony\Component\HttpFoundation\HeaderBag)</strong>, y contiene la información referente a cabeceras http de la petición.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">);</span>
<span class="lineno">4</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">);</span>
<span class="lineno">5</span> 
<span class="lineno">6</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">());</span></code></pre></figure>

<p>Los indices contenidos en la colección estan normalizados y en minuscula.</p>

<h2>El método Request::get()</h2>

<p>Este método es un atajo para obtener un parametro que puede estar en algunas de las propiedades  query, attributes o request, y mantiene ese mismo orden de procedencia en la busqueda.</p>

<p>Es muy útil cuando por ejemplo se usa el routing de symfony y guardamos los parametros de la url en la propiedad atributes del objeto $request, o lo enviamos por get, este método igual encontrará dicho valor.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">);</span>
<span class="lineno">4</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="lineno">5</span> <span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">);</span></code></pre></figure>

<p>Supongamos que estamos creando una web sin sistema de ruta pero usando el componente HttpFoundation, y estamos paginando una consulta:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="c1">// URL: http://example.com/paises/?page=3</span>
<span class="lineno">4</span> 
<span class="lineno">5</span> <span class="nv">$currentPage</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//encontrará el valor en $_GET y devolverá un 3</span>
<span class="lineno">6</span> <span class="c1">//Paginado ...</span>
<span class="lineno">7</span> <span class="k">echo</span> <span class="nv">$currentPage</span><span class="p">;</span> <span class="c1">//mostrará 3</span></code></pre></figure>

<p>Si luego en ese proyecto implementamos un sistema de routing, como por ejemplo el de symfony y guardamos los parametros de la url en attributes:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="lineno">1</span> <span class="l-Scalar-Plain">paises</span><span class="p-Indicator">:</span>
<span class="lineno">2</span>     <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/paises/{page}</span>
<span class="lineno">3</span>     <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span>
<span class="lineno">4</span>         <span class="l-Scalar-Plain">...</span></code></pre></figure>

<p>Ahora el parametro no se envia por GET, sino que forma parte de la url, pero el routing de symfony, guarda el valor de ese parametro en <strong>$request-&gt;attributes</strong>, entonces nuestro cógido sigue funcionando sin tocar nada:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="c1">// URL: http://example.com/paises/3</span>
<span class="lineno">4</span> 
<span class="lineno">5</span> <span class="nv">$currentPage</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//encontrará el valor en attributes de request y devolverá un 3</span>
<span class="lineno">6</span> <span class="c1">//Paginado ...</span>
<span class="lineno">7</span> <span class="k">echo</span> <span class="nv">$currentPage</span><span class="p">;</span> <span class="c1">//mostrará 3</span></code></pre></figure>

<p>Este es un buen ejemplo de lo util que puede ser el método get() y el uso práctico de la propiedad attributes.</p>

<h3>Metodos útiles de ParameterBag</h3>

<p>Algunos métodos de interes:</p>

<ul>
<li>  <strong>get($path, $default = null, $deep = false)</strong>: devuelve un valor contenido en el índice pasado.</li>
<li>  <strong>has($key)</strong>: devuelve true si existe el indice en la colección.</li>
<li>  <strong>remove($key)</strong>: elimina un valor contenido en el índice especificado.</li>
<li>  <strong>getAlnum($key, $default = &#39;&#39;, $deep = false)</strong>: devuelve el valor filtrado alfanumericamente.</li>
<li>  <strong>getAlpha($key, $default = &#39;&#39;, $deep = false)</strong>: devuelve el valor filtrado alfabeticamente.</li>
<li>  <strong>getDigits($key, $default = &#39;&#39;, $deep = false)</strong>: devuelve solo los digitos.</li>
<li>  <strong>getInt($key, $default = &#39;&#39;, $deep = false)</strong>: devuelve el valor convertido en int.</li>
</ul>

<h2>Ventajas de usar el objeto Request</h2>

<p>El objeto request ofrece una serie de métodos que nos facilitarán la vida al programar.</p>

<p>Un ejemplo de ello puede ser conocer si la petición es mediante ajax o no, en php seria algo como:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">])</span>
<span class="lineno">4</span>     <span class="k">AND</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="s1">&#39;xmlhttprequest&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">5</span>     <span class="c1">// AJAX</span>
<span class="lineno">6</span> <span class="p">}</span></code></pre></figure>

<p>Mientras que con el componente seria algo como:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isXmlHttpRequest</span><span class="p">())</span> <span class="p">{</span>
<span class="lineno">4</span>     <span class="c1">// AJAX</span>
<span class="lineno">5</span> <span class="p">}</span></code></pre></figure>

<p>Existen otros métodos en la clase como:</p>

<ul>
<li>  getLanguages().</li>
<li>  getCharsets().</li>
<li>  getBasePath().</li>
</ul>

<p>Entre otros métodos, que nada más hecharles una mirada interna, se puede apreciar que nos ahorran un montón de trabajo para obtener esos datos.</p>

<h1>La clase Response</h1>

<p>Esta clase permite manejar de forma simple el envio del contenido y las cabeceras que serán devueltas al servidor.</p>

<p>Ejemplo de uso:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s2">&quot;Hola Mundo!!!&quot;</span><span class="p">);</span> <span class="c1">//crea el objeto con las cabeceras</span>
<span class="lineno"> 6</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span> <span class="c1">//envia las cabeceras y el contenido</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s2">&quot;No existe la Página :-(&quot;</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span> <span class="c1">//establecemos el codigo de estado de la respuesta</span>
<span class="lineno"> 9</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="c1">//enviando una respuesta en formato json</span>
<span class="lineno">12</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;[&quot;Mi valor&quot;]&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">));</span> 
<span class="lineno">13</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno">14</span> <span class="c1">// otra forma de hacerlo</span>
<span class="lineno">15</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;[&quot;Mi valor&quot;]&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> 
<span class="lineno">16</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
<span class="lineno">17</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno">18</span> 
<span class="lineno">19</span> <span class="k">if</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isOk</span><span class="p">()){</span>
<span class="lineno">20</span>     <span class="c1">//respuesta exitosa</span>
<span class="lineno">21</span> <span class="p">}</span>
<span class="lineno">22</span> 
<span class="lineno">23</span> <span class="k">if</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isRedirection</span><span class="p">()){</span>
<span class="lineno">24</span>     <span class="c1">//se está redireccionando</span>
<span class="lineno">25</span> <span class="p">}</span>
<span class="lineno">26</span> 
<span class="lineno">27</span> <span class="k">if</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">(</span><span class="s1">&#39;/pais&#39;</span><span class="p">)){</span>
<span class="lineno">28</span>     <span class="c1">//se está redireccionando a /pais</span>
<span class="lineno">29</span> <span class="p">}</span>
<span class="lineno">30</span> 
<span class="lineno">31</span> <span class="k">if</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isServerError</span><span class="p">()){</span>
<span class="lineno">32</span>     <span class="c1">//error del servidor :-/</span>
<span class="lineno">33</span> <span class="p">}</span></code></pre></figure>

<p>El constructor de la clase espera tres parametros:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="sd">/**</span>
<span class="lineno"> 4</span> <span class="sd"> * Constructor.</span>
<span class="lineno"> 5</span> <span class="sd"> *</span>
<span class="lineno"> 6</span> <span class="sd"> * @param string  $content The response content</span>
<span class="lineno"> 7</span> <span class="sd"> * @param integer $status  The response status code</span>
<span class="lineno"> 8</span> <span class="sd"> * @param array   $headers An array of response headers</span>
<span class="lineno"> 9</span> <span class="sd"> *</span>
<span class="lineno">10</span> <span class="sd"> * @throws \InvalidArgumentException When the HTTP status code is not valid</span>
<span class="lineno">11</span> <span class="sd"> *</span>
<span class="lineno">12</span> <span class="sd"> * @api</span>
<span class="lineno">13</span> <span class="sd"> */</span>
<span class="lineno">14</span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$status</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="nv">$headers</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span></code></pre></figure>

<p>Tambien podemos crear la instancia de la siguiente manera:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="nv">$response</span> <span class="o">=</span> <span class="nx">Response</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s2">&quot;Hola Mundo!!!&quot;</span><span class="p">);</span>
<span class="lineno"> 6</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="c1">//asi podemos hacer algo como:</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="nx">Response</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s2">&quot;Mi contenido&quot;</span><span class="p">)</span>
<span class="lineno">11</span>     <span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="lineno">12</span>     <span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span></code></pre></figure>

<p>Es importante destacar que es el método <strong>send()</strong> el que realmente hace el envío de las cabeceras y el contenido.</p>

<p>Además el componente ofrece otra serie de clases de respuesta para facilitar aun más las cosas.</p>

<h4>Clase RedirectResponse</h4>

<p>Esta clase crea una respuesta con el contenido y cabeceras correspondientes a un redirección http, acepta los siguientes parametros en su constructor:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="sd">/**</span>
<span class="lineno"> 4</span> <span class="sd"> * Creates a redirect response so that it conforms to the rules </span>
<span class="lineno"> 5</span> <span class="sd"> * defined for a redirect status code.</span>
<span class="lineno"> 6</span> <span class="sd"> *</span>
<span class="lineno"> 7</span> <span class="sd"> * @param string  $url     The URL to redirect to</span>
<span class="lineno"> 8</span> <span class="sd"> * @param integer $status  The status code (302 by default)</span>
<span class="lineno"> 9</span> <span class="sd"> * @param array   $headers The headers (Location is always set to the given url)</span>
<span class="lineno">10</span> <span class="sd"> *</span>
<span class="lineno">11</span> <span class="sd"> * @throws \InvalidArgumentException</span>
<span class="lineno">12</span> <span class="sd"> *</span>
<span class="lineno">13</span> <span class="sd"> * @see http://tools.ietf.org/html/rfc2616#section-10.3</span>
<span class="lineno">14</span> <span class="sd"> *</span>
<span class="lineno">15</span> <span class="sd"> * @api</span>
<span class="lineno">16</span> <span class="sd"> */</span>
<span class="lineno">17</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$status</span> <span class="o">=</span> <span class="mi">302</span><span class="p">,</span> <span class="nv">$headers</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span></code></pre></figure>

<p>Ejemplo de uso:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\RedirectResponse</span><span class="p">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RedirectResponse</span><span class="p">(</span><span class="s2">&quot;http://google.com&quot;</span><span class="p">);</span>
<span class="lineno"> 6</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RedirectResponse</span><span class="p">(</span><span class="s2">&quot;/otro_archivo_de_mi_host.html&quot;</span><span class="p">);</span>
<span class="lineno"> 9</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="nx">RedirectResponse</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s2">&quot;http://google.com&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span></code></pre></figure>

<p>Esta clase nos ahorra las tarea de: </p>

<ul>
<li>  Crear el header <strong>Location</strong> que hace la redirección http.</li>
<li>  Crear el header con el código de estado 302 (que podemos cambiar en el segundo argumento del constructor).</li>
<li>  Crear el html con la etiqueta &lsaquo;meta http-equiv=&quot;refresh&quot; content=&quot;1;url=mi-url&quot; /&rsaquo;.</li>
</ul>

<h4>Clase JsonResponse</h4>

<p>Esta clase crea una respuesta con el contenido y cabeceras para el formato json, acepta los siguientes parametros en su constructor:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="sd">/**</span>
<span class="lineno"> 4</span> <span class="sd"> * Constructor.</span>
<span class="lineno"> 5</span> <span class="sd"> *</span>
<span class="lineno"> 6</span> <span class="sd"> * @param mixed   $data    The response data</span>
<span class="lineno"> 7</span> <span class="sd"> * @param integer $status  The response status code</span>
<span class="lineno"> 8</span> <span class="sd"> * @param array   $headers An array of response headers</span>
<span class="lineno"> 9</span> <span class="sd"> */</span>
<span class="lineno">10</span>  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$status</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="nv">$headers</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span></code></pre></figure>

<p>Ejemplo de uso:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\JsonResponse</span><span class="p">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="nv">$datos</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 6</span>     <span class="s1">&#39;nombre&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Manuel&#39;</span><span class="p">,</span>
<span class="lineno"> 7</span>     <span class="s1">&#39;pais&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Venezuela&#39;</span><span class="p">,</span>
<span class="lineno"> 8</span> <span class="p">);</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JsonResponse</span><span class="p">(</span><span class="nv">$datos</span><span class="p">);</span>
<span class="lineno">11</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="lineno">12</span> 
<span class="lineno">13</span> <span class="nx">JsonResponse</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$datos</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span></code></pre></figure>

<p>Esta clase nos ahorra las tarea de:</p>

<ul>
<li>  Crear el header <strong>Content-Type</strong> correspondiente.</li>
<li>  Convertir a json el arreglo que se pasa como parametro.</li>
</ul>

<h4>Clase BinaryFileResponse</h4>

<h4>Clase StreamedResponse</h4>

        </section>

        

        <footer class="post-footer">
            
            <section class="author">
                <header> <a href="http://manuelj555.github.io/"> <img class="profile" src="/assets/images/profile.png" alt="Author's profile picture"></a></header>
                <article>
                    <h4> Manuel Aguirre <programador.manuel@gmail.com> </h4>
                    <p> 
                        Desarrollador Web, (PHP, HTML, css, javascript).<br/>
                        Intento usar Symfony2 y/o sus componentes en mis proyectos.<br/>
                        Apasionado por el aprendizaje y loco por la Programación :-)
                    </p>
                </article>
            </section>                
            

            <section class="share">
                <h4>Comparte</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Usando el componente HttpFoundation&amp;url=/2014/02/24/usando-http-foundation.html"
                   onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');
                           return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=/2014/02/24/usando-http-foundation.html"
                   onclick="window.open(this.href, 'facebook-share', 'width=580,height=296');
                           return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=/2014/02/24/usando-http-foundation.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');
                           return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

            
            <section class="disqus">
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'phpsymfonytipsmanuelj555'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script');
                        dsq.type = 'text/javascript';
                        dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </section>
            

        </footer>

    </article>

</main>


    <script type="text/javascript" src="/assets/js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-59688229-1', 'auto');
        ga('send', 'pageview');

    </script>
</body>
</html>
